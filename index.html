<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - animation - keyframes</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link type="text/css" rel="stylesheet" href="">
        <style>
            body {
                background-color: #bfe3dd;
                color: #000;
                margin: 0
            }


        </style>
    </head>
    <body>
        <div id="container"></div>
        <script type="importmap">
            {
                "imports": {
                    "three": "./build/three.module.js"
                }
            }
        </script>
        <script type="module">
            import * as THREE from 'three';

            import { OrbitControls } from './jsm/controls/OrbitControls.js';
            import { RoomEnvironment } from './jsm/environments/RoomEnvironment.js';

            import { GLTFLoader } from './jsm/loaders/GLTFLoader.js';
            import { DRACOLoader } from './jsm/loaders/DRACOLoader.js';

            const container = document.getElementById('container');

            let mixer

            const clock = new THREE.Clock();

            //renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            container.appendChild(renderer.domElement);

            //scene
            const pmremGenerator = new THREE.PMREMGenerator(renderer);
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xbfe3dd);
            scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

            //camera
            const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight);
            camera.position.set(5,2,8);

            //controls
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0.5, 0);
            controls.update();
            controls.enablePan = false;
            controls.enableDamping = true;

            //loader
            const dracoLoader = new DRACOLoader();
            dracoLoader.setDecoderPath('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/js/libs/draco/'); // use a full url path

            const loader = new GLTFLoader();
            loader.setDRACOLoader(dracoLoader);
            loader.load('models/gltf/LittlestTokyo.glb', function(gltf){
                const model = gltf.scene;
                console.log('model', model)
                model.position.set(1,1,0);
                model.scale.set(0.008, 0.008, 0.008);
                scene.add(model);

                mixer = new THREE.AnimationMixer(model);
                mixer.clipAction(gltf.animations[0]).play();

                animate()
                
            }, undefined, function(e){
                console.error(e);
            })

            //window resize
            window.onresize = function(){
                camera.aspect = window.innerWidth/window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate(){
                requestAnimationFrame(animate);

                const delta = clock.getDelta();

                mixer.update(delta);


                //run
                renderer.render(scene, camera)

            }

           
        </script>
    </body>
</html>